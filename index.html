<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FamGame - Couples Reward System</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f4f4; margin: 0; padding: 20px; }
        .container { max-width: 700px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #004d40; }
        .task, .reward { padding: 10px; margin: 10px 0; background: #e8f5e9; border-radius: 5px; cursor: pointer; display: flex; justify-content: space-between; }
        .task:hover, .reward:hover { background: #c8e6c9; }
        #points { text-align: center; font-size: 24px; font-weight: bold; color: #004d40; }
        .section { margin-top: 20px; }
        button { background-color: #004d40; color: white; border: none; padding: 10px; border-radius: 5px; cursor: pointer; }
        button:hover { background-color: #00332a; }
        .progress { text-align: center; font-size: 18px; margin-top: 10px; color: #004d40; }
    </style>
</head>
<body>
    <div class="container">
        <h1>FamGame - Couples Reward System</h1>
        <h2>Total Points: <span id="totalPoints">0</span></h2>
        <div class="progress">
            Husband Contribution: <span id="husbandPercent">0%</span> | Wife Contribution: <span id="wifePercent">0%</span>
        </div>
        <div class="section">
            <h2>Husband Tasks</h2>
            <div class="task" onclick="addPoints('husband', 10)">Prepare Surprise <span>+10 pts</span></div>
            <div class="task" onclick="addPoints('husband', 15)">Plan Date Night <span>+15 pts</span></div>
            <div class="task" onclick="addPoints('husband', 20)">Cook a Special Dinner <span>+20 pts</span></div>
            <div class="task" onclick="addPoints('husband', 25)">Write a Love Letter <span>+25 pts</span></div>
        </div>
        <div class="section">
            <h2>Wife Tasks</h2>
            <div class="task" onclick="addPoints('wife', 10)">Cook Favorite Meal <span>+10 pts</span></div>
            <div class="task" onclick="addPoints('wife', 15)">Support Husband's Project <span>+15 pts</span></div>
            <div class="task" onclick="addPoints('wife', 20)">Plan a Relaxing Spa Day <span>+20 pts</span></div>
            <div class="task" onclick="addPoints('wife', 25)">Leave a Sweet Note <span>+25 pts</span></div>
        </div>
        <div class="section">
            <h2>Rewards</h2>
            <div class="reward" onclick="redeemPoints(50)">Movie Night <span>-50 pts</span></div>
            <div class="reward" onclick="redeemPoints(100)">Romantic Getaway <span>-100 pts</span></div>
        </div>
        <div class="section">
            <button onclick="resetPoints()">Reset Points</button>
        </div>
    </div>
    <script>
        let sheetId = "1YVO59qBs1atrOgY6rJLUI75-KzKBF78iN5ZH8r6Yv0o";
        let apiKey = "YOUR_GOOGLE_API_KEY";
        let accessToken = localStorage.getItem("google_access_token") || null;

        function authenticate() {
            let clientId = "203005866385-jm1rkp0u1j94i8iilgs4dn9l7j5ivm2a.apps.googleusercontent.com";
            let redirectUri = "https://gk895.github.io/FamGame/";
            let scope = "https://www.googleapis.com/auth/spreadsheets";
            let authUrl = `https://accounts.google.com/o/oauth2/auth?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=token&scope=${scope}&prompt=consent`;
            window.location.href = authUrl;
        }

         function getAccessTokenFromURL() {
            let params = new URLSearchParams(window.location.hash.substring(1));
            return params.get("access_token");
        }

        async function fetchPoints() {
            if (!accessToken) return authenticate();
            let sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1!A2:C2?key=${apiKey}`;
            let response = await fetch(sheetUrl, { headers: { "Authorization": `Bearer ${accessToken}` } });
            let data = await response.json();
            let values = data.values ? data.values[0] : [0, 0, 0];
            updateUI(parseInt(values[0]) || 0, parseInt(values[1]) || 0);
        }

        async function updatePoints(husbandPoints, wifePoints) {
            if (!accessToken) return authenticate();
            let sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1!A2:C2?key=${apiKey}`;
            let response = await fetch(sheetUrl, { headers: { "Authorization": `Bearer ${accessToken}` } });
            let data = await response.json();
            let values = data.values ? data.values[0] : [0, 0, 0];
            husbandPoints += parseInt(values[0]) || 0;
            wifePoints += parseInt(values[1]) || 0;
            let updatedValues = [[husbandPoints, wifePoints, husbandPoints + wifePoints]];
            let updateUrl = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/Sheet1!A2:C2?valueInputOption=RAW`;
            await fetch(updateUrl, {
                method: "PUT",
                headers: { "Authorization": `Bearer ${accessToken}`, "Content-Type": "application/json" },
                body: JSON.stringify({ values: updatedValues })
            });
            updateUI(husbandPoints, wifePoints);
        }

        function addPoints(person, value) {
            fetchPoints().then(() => {
                let husbandPoints = 0;
                let wifePoints = 0;
                if (person === 'husband') husbandPoints += value;
                else wifePoints += value;
                updatePoints(husbandPoints, wifePoints);
            });
        }

        function updateUI(husbandPoints, wifePoints) {
            let totalPoints = husbandPoints + wifePoints;
            document.getElementById('totalPoints').innerText = totalPoints;
            document.getElementById('husbandPercent').innerText = `${Math.round((husbandPoints / totalPoints) * 100)}%`;
            document.getElementById('wifePercent').innerText = `${Math.round((wifePoints / totalPoints) * 100)}%`;
        }

        function resetPoints() {
            updatePoints(0, 0);
        }

        accessToken = getAccessTokenFromURL();
        if (!accessToken) authenticate();
        else fetchPoints();
    </script>
</body>
</html>
